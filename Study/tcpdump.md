1. tcpdump -en -s 0 -XX -i eth0
2. tcpdump -i eth0 -nexxvv -s0
3. tcpdump  -i eth2 -neXXvv -s0 ether[12]=0x91
2008-12-05 19:18:39|  分类： Unix/Linux |字号 订阅
tcpdump采用命令行方式,它的命令格式为:
tcpdump [-adeflnNOpqStvx] [-c 数量] [-F 文件名] [-i 网络接口] [-r 文件名] [-s snaplen] [-T 类型] [-w 文件名] [表达式]

(1).tcpdump的选项介绍:
-a 　将网络地址和广播地址转变成名字;
-d 　将匹配信息包的代码以人们能够理解的汇编格式给出;
-dd  将匹配信息包的代码以c语言程序段的格式给出;
-ddd 将匹配信息包的代码以十进制的形式给出;
-e 　在输出行打印出数据链路层的头部信息；
-f 　将外部的Internet地址以数字的形式打印出来;
-l 　使标准输出变为缓冲行形式;
-n 　不把网络地址转换成名字;
-t 　在输出的每一行不打印时间戳;
-v 　输出一个稍微详细的信息,例如在ip包中可以包括ttl和服务类型的信息;
-vv  输出详细的报文信息;
-c 　在收到指定的包的数目后,tcpdump就会停止;
-F 　从指定的文件中读取表达式,忽略其它的表达式;
-i 　指定监听的网络接口;
-r   从指定的文件中读取包(这些包一般通过-w选项产生);
-w 　直接将包写入文件中,并不分析和打印出来;
-T 　将监听到的包直接解释为指定的类型的报文,常见的类型有rpc(远程过程调用)和snmp(简单网络管理协议);
-v   详细显示指令执行过程;
-vv  更详细显示指令执行过程;
-x   用十六进制字码列出数据包资料;
-X   用十六进制字码列出数据包资料,并显示对应的数据包内容简介;
-w   <数据包文件> 把数据包数据写入指定的文件;

(2).tcpdump的表达式介绍:
表达式是一个正则表达式,tcpdump利用它作为过滤报文的条件,如果一个报文满足表达式的条件,则这个报文将会被捕获.如果没有给出任何条件,则网络上所有的信息包将会被截获.在表达式中一般如下几种类型的关键字.

第一种是关于类型的关键字,主要包括host,net,port, 例如 host 210.27.48.2,指明 210.27.48.2是一台主机,net 202.0.0.0 指明 202.0.0.0是一个网络地址,port 23 指明端口号是23.如果没有指定类型,缺省的类型是host. 
第二种是确定传输方向的关键字,主要包括src , dst ,dst or src, dst and src ,这些关键字指明了传输的方向.举例说明,src 210.27.48.2 ,指明ip包中源地址是210.27.48.2 , dst net 202.0.0.0 指明目的网络地址是202.0.0.0 .如果没有指明方向关键字,则缺省是src or dst关键字

第三种是协议的关键字,主要包括fddi,ip,arp,rarp,tcp,udp等类型.Fddi指明是在FDDI(分布式光纤数据接口网络)上的特定 的网络协议,实际上它是"ether"的别名,fddi和ether具有类似的源地址和目的地址,所以可以将fddi协议包当作ether的包进行处理和 分析.其他的几个关键字就是指明了监听的包的协议内容.如果没有指定任何协议,则tcpdump将会监听所有协议的信息包.

除了这三种类型的关键字之外,其他重要的关键字如下:gateway, broadcast,less,greater,还有三种逻辑运算,取非运算是not或!,与运算是and、&&; 或运算是or,||这些关键字可以组合起来构成强大的组合条件来满足人们的需要,下面举几个例子来说明.

A想要截获所有210.27.48.1 的主机收到的和发出的所有的数据包:
#tcpdump host 210.27.48.1 
B想要截获主机210.27.48.1 和主机210.27.48.2 或210.27.48.3的通信,使用命令:（在命令行中适用　　　括号时,一定要
#tcpdump host 210.27.48.1 and \ (210.27.48.2 or 210.27.48.3 \) 
C如果想要获取主机210.27.48.1除了和主机210.27.48.2之外所有主机通信的ip包,使用命令:
#tcpdump ip host 210.27.48.1 and ! 210.27.48.2
D如果想要获取主机210.27.48.1接收或发出的telnet包,使用如下命令:
#tcpdump tcp port 23 host 210.27.48.1

(3).tcpdump的输出结果介绍:
下面我们介绍几种典型的tcpdump命令的输出信息 
A.数据链路层头信息,使用命令
#tcpdump --e host ice
ice 是一台装有linux的主机,她的MAC地址是0:90:27:58:AF:1A
H219是一台装有SOLARIC的SUN工作站,它的MAC地址是8:0:20:79:5B:46；上一条命令的输出结果如下所示:
21:50:12.847509 eth0 < 8:0:20:79:5b:46 0:90:27:58:af:1a ip 60: h219.33357 > ice.telne
t 0:0(0) ack 22535 win 8760 (DF)

分析:21:50件中留下记录,提醒管理员留意这台系ç°:
-a     尝试将网络和广播地址转换成名称;
-c     <数据包数目> 收到指定的数据包数目后,就停止
